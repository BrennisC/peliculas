<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:insert="~{layout/header.html}"></head>
<link rel="stylesheet" th:href="@{/css/peliculas.css}">

<body>

    <!-- Lista de películas -->

    <div class="container my-4">
        <h3>Lista de Películas</h3>

        <div th:if="${#lists.isEmpty(peliculas)}" class="alert alert-info">
            No hay películas registradas.
        </div>

        <div th:if="${!#lists.isEmpty(peliculas)}">
            <!-- Información de paginación -->
            <div class="mb-3">
                <p class="text-muted">
                    Mostrando <span th:text="${(currentPage * pageSize) + 1}"></span> a
                    <span th:text="${(currentPage * pageSize) + #lists.size(peliculas)}"></span>
                    de <span th:text="${totalElements}"></span> películas
                </p>
            </div>

            <!-- Tabla de películas -->
            <div class="table-responsive">
                <table class="table table-striped table-hover table-peliculas">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Título</th>
                            <th>Fecha de Estreno</th>
                            <th>Género</th>
                            <th>Actores</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="pelicula : ${peliculas}">
                            <td th:text="${pelicula.id}"></td>
                            <td th:text="${pelicula.nombre}" class="pelicula-titulo"></td>
                            <td th:text="${#dates.format(pelicula.fechaEstreno, 'dd/MM/yyyy')}"></td>
                            <td>
                                <span th:if="${pelicula.genero != null}" th:text="${pelicula.genero.nombre}"
                                    class="badge bg-secondary genero-badge"></span>
                                <span th:if="${pelicula.genero == null}" class="text-muted">Sin género</span>
                            </td>
                            <td>
                                <div th:if="${pelicula.protagonistas != null && !#lists.isEmpty(pelicula.protagonistas)}"
                                    class="actors-container">
                                    <div th:each="actor : ${pelicula.protagonistas}" class="actor-chip">
                                        <img th:src="@{${actor.urlImagen}}" th:alt="${actor.nombre}"
                                            class="actor-avatar-large" onerror="handleImageError(this)" />
                                        <span th:text="${actor.nombre}" class="actor-name"></span>
                                    </div>
                                </div>
                                <span
                                    th:if="${pelicula.protagonistas == null || #lists.isEmpty(pelicula.protagonistas)}"
                                    class="no-actores">
                                    Sin actores asignados
                                </span>
                            </td>
                            <td>
                                <a th:href="@{/peliculas/edit/{id}(id=${pelicula.id})}"
                                    class="btn btn-warning btn-sm me-1">
                                    Editar
                                </a>
                                <a th:href="@{/peliculas/delete/{id}(id=${pelicula.id})}" class="btn btn-danger btn-sm"
                                    onclick="return confirm('¿Está seguro de que desea eliminar esta película?')">
                                    Eliminar
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Controles de paginación -->
            <nav aria-label="Paginación de películas">
                <ul class="pagination justify-content-center">
                    <!-- Botón Anterior -->
                    <li th:class="${hasPrevious} ? 'page-item' : 'page-item disabled'">
                        <a th:if="${hasPrevious}" th:href="@{/peliculas(page=${currentPage - 1}, size=${pageSize})}"
                            class="page-link">Anterior</a>
                        <span th:if="${!hasPrevious}" class="page-link">Anterior</span>
                    </li>

                    <!-- Números de página -->
                    <li th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
                        th:class="${pageNum == currentPage} ? 'page-item active' : 'page-item'"
                        th:if="${pageNum >= currentPage - 2 && pageNum <= currentPage + 2}">
                        <a th:if="${pageNum != currentPage}" th:href="@{/peliculas(page=${pageNum}, size=${pageSize})}"
                            th:text="${pageNum + 1}" class="page-link"></a>
                        <span th:if="${pageNum == currentPage}" th:text="${pageNum + 1}" class="page-link"></span>
                    </li>

                    <!-- Botón Siguiente -->
                    <li th:class="${hasNext} ? 'page-item' : 'page-item disabled'">
                        <a th:if="${hasNext}" th:href="@{/peliculas(page=${currentPage + 1}, size=${pageSize})}"
                            class="page-link">Siguiente</a>
                        <span th:if="${!hasNext}" class="page-link">Siguiente</span>
                    </li>
                </ul>
            </nav>

            <!-- Selector de tamaño de página -->
            <div class="row mt-3">
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <label class="form-label me-2 mb-0">Elementos por página:</label>
                        <select class="form-select form-select-sm" style="width: auto;"
                            onchange="window.location.href='/administrar_peliculas?page=0&size=' + this.value">
                            <option th:value="5" th:selected="${pageSize == 5}">5</option>
                            <option th:value="10" th:selected="${pageSize == 10}">10</option>
                            <option th:value="20" th:selected="${pageSize == 20}">20</option>
                            <option th:value="50" th:selected="${pageSize == 50}">50</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6 text-end">
                    <small class="text-muted">
                        Página <span th:text="${currentPage + 1}"></span> de <span th:text="${totalPages}"></span>
                    </small>
                </div>
            </div>
        </div>
    </div>
</body>
<script th:src="@{/js/actor-selector.js}"></script>

</html>